<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Bundles</title>
<link rel="stylesheet" href="../default.css" type="text/css" />
</head>
<body>
<div class="document" id="bundles">
<h1 class="title">Bundles</h1>

<div class="section" id="status">
<h1><a class="toc-backref" href="#id1">Status</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Date:</th><td class="field-body">2007-06-19</td>
</tr>
</tbody>
</table>
<p>This document describes the current and future design of the bzr bundle facility.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#status" id="id1">Status</a></li>
<li><a class="reference internal" href="#motivation" id="id2">Motivation</a></li>
<li><a class="reference internal" href="#desired-features" id="id3">Desired features</a></li>
<li><a class="reference internal" href="#historical-design" id="id4">Historical Design</a></li>
<li><a class="reference internal" href="#june-2007-design" id="id5">June 2007 Design</a></li>
<li><a class="reference internal" href="#future-plans" id="id6">Future Plans</a><ul>
<li><a class="reference internal" href="#physical-encoding" id="id7">Physical encoding</a></li>
<li><a class="reference internal" href="#code-reuse" id="id8">Code reuse</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id2">Motivation</a></h1>
<p>Bundles are intended to be a compact binary representation of the changes done within
a branch for transmission between users. Bundles should be able to be used
easily and seamlessly - we want to avoid having a parallel set of commands to
get data from within a bundle.</p>
<p>A related concept is <strong>merge directives</strong> which are used to transmit bzr merge
and merge-like operations from one user to another in such a way that the
recipient can be sure they get the correct data the initiator desired.</p>
</div>
<div class="section" id="desired-features">
<h1><a class="toc-backref" href="#id3">Desired features</a></h1>
<ul class="simple">
<li>A bundle should be able to substitute for the entire branch in any bzr
command that operates on branches in a read only fashion.</li>
<li>Bundles should be as small as possible without losing data to keep them
feasible for including in emails.</li>
</ul>
</div>
<div class="section" id="historical-design">
<h1><a class="toc-backref" href="#id4">Historical Design</a></h1>
<p>Not formally documented, the current released implementation can be found
in bzrlib.bundle.serializer. One key element is that this design included
parts of the branch data as human readable diffs; which were then subject
to corruption by transports such as email.</p>
</div>
<div class="section" id="june-2007-design">
<h1><a class="toc-backref" href="#id5">June 2007 Design</a></h1>
<p><a class="reference external" href="bundle-format4.html">Bundle Format 4 spec</a></p>
</div>
<div class="section" id="future-plans">
<h1><a class="toc-backref" href="#id6">Future Plans</a></h1>
<p>Bundles will be implemented as a 'Shallow Branch' with the branch and
repository data combined into a single file. This removes the need to
special case bundle handling for all command which read from branches.</p>
<div class="section" id="physical-encoding">
<h2><a class="toc-backref" href="#id7">Physical encoding</a></h2>
<p>Bundles will be encoded using the bzr pack format. Within the pack the
branch metadata will be serialised as a BzrMetaDir1 branch entry. The
Repository data added by the revisions contained in the bundle will be
encoded using multi parent diffs as they are the most pithy diffs we are
able to create today in the presence of merges. XXX More details needed?</p>
</div>
<div class="section" id="code-reuse">
<h2><a class="toc-backref" href="#id8">Code reuse</a></h2>
<p>Ideally we can reuse our BzrMetaDir based branch formats directly within a
Bundle by layering a Transport interface on top of the pack - or just
copying the data out into a readonly memory transport when we read the
pack. This suggests we will have a pack specific Control instance,
replacing the usual 'BzrDir' instance, but use the Branch class as-is.</p>
<p>For the Repository access, we will create a composite Repository using the
planned Repository Stacking API, and a minimal Repository implementation
that can work with the multi parent diffs within the bundle.</p>
<p>We will need access to a branch that has the basis revision of the bundle
to be able to construct revisions from within it - this is a requirement
for Shallow Branches too, so hopefully we can define a single mechanism at
the Branch level to gain access to that.</p>
<!-- vim: ft=rst tw=74 ai -->
</div>
</div>
</div>
</body>
</html>
