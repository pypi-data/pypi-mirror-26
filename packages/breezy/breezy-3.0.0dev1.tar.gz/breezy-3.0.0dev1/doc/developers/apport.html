<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Bazaar Apport Integration</title>
<link rel="stylesheet" href="../default.css" type="text/css" />
</head>
<body>
<div class="document" id="bazaar-apport-integration">
<h1 class="title">Bazaar Apport Integration</h1>

<p>Bazaar can use Apport &lt;<a class="reference external" href="http://launchpad.net/apport/">http://launchpad.net/apport/</a>&gt; to capture data about
unexpected errors (probably, bugs in Bazaar) and report them to the
developers.</p>
<p>This is only active for errors that are believed to be internal errors (ie
bugs) not user or environmental errors.  (See the Developer Guide.)</p>
<div class="section" id="consequences-for-users">
<h1>Consequences for users</h1>
<ul class="simple">
<li>They shouldn't normally need to see or copy&amp;paste a traceback.</li>
<li>They will be able to inspect the files before sending them to be sure
there's no sensitive data included.</li>
<li>As at present, they'll need a Launchpad account to report bugs in the
normal way.</li>
</ul>
</div>
<div class="section" id="implementation-notes">
<h1>Implementation notes</h1>
<p>The use of apport by Bazaar is independent of the configuration in the OS.
For example in Ubuntu, apport is normally inactive in release builds, and
normally excludes software not installed from a package.  We'll bypass
both of them.</p>
<p>Putting in this handler may mean that an OS-wide exception handler never
sees the error, but that was true with our existing exception-printer.</p>
<p>The user should have the option to: forget about the crash (and ignore the
bug report), see the contents of the report, file a bug, or save the
report to file later.  At the moment we just show them the filename and
let them take it from there.</p>
<p>The process is</p>
<ol class="arabic simple">
<li>An exception reaches the top-level handler.</li>
<li>We log it in apport-format to a file in ~/.bazaar/crash.</li>
<li>We tell the user where that file is, and invite them to file a bug
report.</li>
</ol>
<p>This won't be active for bugs that cause the whole Python interpreter to
crash.  This can be handled at the OS level.  The nice thing is that if
apport is active system-wide, it will catch either exceptions in our
in-process apport handler, or errors that crash the intrepreter.</p>
</div>
<div class="section" id="future-ideas">
<h1>Future ideas</h1>
<ul>
<li><p class="first">Capture apport data even for things not believed to be internal errors,
because sometimes they are in fact bugs.  Then the user can attach the
apport report later if they decide to file a bug.  There may be quite a
lot of them so we might need to limit the number that are stored, or do
this when a debug flag is set.  At the moment they go into .bzr.log and
that's probably ok to start with.</p>
</li>
<li><p class="first">Raising an error from the breakin debugger should cause this to fire.</p>
</li>
<li><p class="first">Developers looking at a crash on their own machine will probably in the
first instance just want to see the traceback. Apport files may be more
longwinded than our current output and might make the traceback scroll
off the screen.</p>
</li>
<li><p class="first">Automatically trace messages (ie from .bzr.log) in the report.  We could
just include the whole file, but it may be long, and including the whole
thing has a greater risk of including sensitive data.</p>
</li>
<li><p class="first">Ask the user what they want to do with the report: automatically file
it, look at it, see just the traceback, just be told where it is.  This
could be done through the UIFactory so that it can be done through a
graphical dialog.</p>
<p>However, if we've already had an unhandled error in this process there
may be problems in Bazaar that prevent us presenting a clean message...</p>
<p>Possibly these bugs are better reported in the next time bzr runs.</p>
</li>
</ul>
<!-- vim: ft=rst -->
</div>
</div>
</body>
</html>
