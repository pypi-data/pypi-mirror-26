<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Centralized Workflow Tutorial</title>
<link rel="stylesheet" href="../../default.css" type="text/css" />
</head>
<body>
<div class="document" id="centralized-workflow-tutorial">
<h1 class="title">Centralized Workflow Tutorial</h1>

<div class="section" id="overview">
<h1>Overview</h1>
<p>This document describes a possible workflow for using <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a>. That of
using <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a>, the distributed version control system, in a centralized
manner. <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> is designed to be very flexible and allows several
different workflows, from fully decentralized to mostly centralized.  The
workflow used here is meant to ease a new user into more advanced usage of
<a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a>, and allow them to work in a mix of centralized and decentralized
operations.</p>
<p>In general, this document is meant for users coming from a background of
centralized version control systems such as CVS or subversion. It is
common in work settings to have a single central server hosting the
codebase, with several people working on this codebase, keeping their work
in sync.  This workflow is also applicable to a single developer working
on several different machines.</p>
</div>
<div class="section" id="initial-setup">
<h1>Initial Setup</h1>
<p>These are some reasonably simple steps to setup <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> so that it works
well for you.</p>
<div class="section" id="setting-user-email">
<h2>Setting User Email</h2>
<p>Your user identity is stored with each commit. While this doesn't have to
be accurate or unique, it will be used in log messages and
annotations, so it is better to have something real.</p>
<pre class="literal-block">
% brz whoami &quot;John Doe &lt;jdoe&#64;organization.com&gt;&quot;
</pre>
</div>
<div class="section" id="setting-up-a-local-repository">
<h2>Setting up a local Repository</h2>
<p><a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> branches generally copy the history information around with them,
which is part of how you can work in a fully decentralized manner. As an
optimization, it is possible for related branches to combine their storage
needs so that you do not need to copy around all of this history
information whenever you create a new branch.</p>
<p>The best way to do this is to create a <a class="reference internal" href="#shared-repository">Shared Repository</a>. In
general, branches will share their storage if they exist in a
subdirectory of a <a class="reference internal" href="#shared-repository">Shared Repository</a>.  So let's set up a <a class="reference internal" href="#shared-repository">Shared
Repository</a> in our home directory, thus all branches we create
underneath will share their history storage.</p>
<pre class="literal-block">
% brz init-repo --trees ~
</pre>
</div>
<div class="section" id="setting-up-a-remote-repository">
<h2>Setting up a remote Repository</h2>
<p>Many times you want a location where data is stored separately from where
you do your work. This workflow is required by centralized systems
(CVS/SVN).  Usually they are on separate machines, but not always. This is
actually a pretty good setup, especially in a work environment. Since it
ensures a central location where data can be backed up, and means that if
something happens to a developer's machine, no committed work has to be
lost.</p>
<p>So let's set up a shared location for our project on a remote machine
called <tt class="docutils literal">centralhost</tt>. Again, we will use a
<a class="reference internal" href="#shared-repository">Shared Repository</a> to optimize disk usage.</p>
<pre class="literal-block">
% brz init-repo --no-trees brz+ssh://centralhost/srv/brz/
</pre>
<p>You can think of this step as similar to setting up a new cvsroot, or
subversion repository.  The <tt class="docutils literal"><span class="pre">--no-trees</span></tt> option tells brz to not
populate the directory with a working tree.  This is appropriate,
since no one will be making changes directly in the branches within
the central repository.</p>
<p>Here we're using a <tt class="docutils literal">brz+ssh</tt> URL, which means to use Breezy's own
protocol on top of the SSH secure shell.  See the Administrator Guide for
information about setting up a brz+ssh server.</p>
</div>
</div>
<div class="section" id="migrating-an-existing-project-to-breezy">
<h1>Migrating an existing project to Breezy</h1>
<p>Now that we have a repository, let's create a versioned project. Most of
the time, you will already have some code that you are working with,
that you now want to version using <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a>. If the code was originally
in source control, there are many ways to convert the project to <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a>
without losing any history. However, this is outside the scope of this
document. See <a class="reference external" href="http://wiki.bazaar.canonical.com/TrackingUpstream">Tracking Upstream</a> for some possibilities (section
&quot;Converting and keeping history&quot;).</p>
<!-- XXX: We really need a different document for discussing conversion of a
project. Right now TrackingUpstream is the best we have, though. -->
<div class="section" id="developer-1-creating-the-first-revision">
<h2>Developer 1: Creating the first revision</h2>
<p>So first, we want to create a branch in our remote Repository, where we
want to host the project.  Let's assume we have a project named
&quot;sigil&quot; that we want to put under version control.</p>
<pre class="literal-block">
% brz init brz+ssh://centralhost/srv/brz/sigil
</pre>
<p>This can be thought of as the &quot;HEAD&quot; branch in CVS terms, or as the &quot;trunk&quot;
in Subversion terms. We will call this the <tt class="docutils literal">dev</tt> branch.</p>
<p>I prefer working in a subdirectory of my home directory to avoid collisions with all
the other files that end up there. Also, we will want a project
directory where we can hold all of the different branches we end up
working on.</p>
<pre class="literal-block">
% cd ~
% mkdir work
% cd work
% mkdir sigil
% cd sigil
% brz checkout brz+ssh://centralhost/srv/brz/sigil dev
% cd dev
% cp -ar ~/sigil/* .
% brz add
% brz commit -m &quot;Initial import of Sigil&quot;
</pre>
<p>In the previous section, we created an empty branch (the <tt class="docutils literal">/sigil</tt>
branch) on <tt class="docutils literal">centralhost</tt>, and then checkout out this empty branch
onto our workstation to add files from our existing project.  There
are many ways to set up your working directory, but the steps above
make it easy to handle working with feature/bugfix branches. And one
of the strong points of <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> is how well it works with branches.</p>
<p>At this point, because you have a 'checkout' of the remote branch, any
commits you make in <tt class="docutils literal">~/work/sigil/dev/</tt> will automatically be saved
both locally, and on <tt class="docutils literal">centralhost</tt>.</p>
</div>
<div class="section" id="developer-n-getting-a-working-copy-of-the-project">
<h2>Developer N: Getting a working copy of the project</h2>
<p>Since the first developer did all of the work of creating the project,
all other developers would just checkout that branch. <strong>They should
still follow</strong> <a class="reference internal" href="#setting-user-email">Setting User Email</a> and <a class="reference internal" href="#setting-up-a-local-repository">Setting up a local Repository</a>.</p>
<p>To get a copy of the current development tree:</p>
<pre class="literal-block">
% cd ~/work/sigil
% brz checkout brz+ssh://centralhost/srv/brz/sigil dev
</pre>
<p>Now that two people both have a checkout of
<tt class="docutils literal"><span class="pre">brz+ssh://centralhost/srv/brz/sigil</span></tt>, there will be times when one of
the checkouts will be out of date with the current version.
At commit time, <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> will inform the user of this and prevent them from
committing. To get up to date, use <tt class="docutils literal">brz update</tt> to update the
tree with the remote changes. This may require resolving conflicts if the
same files have been modified.</p>
</div>
</div>
<div class="section" id="developing-on-separate-branches">
<h1>Developing on separate branches</h1>
<p>So far everyone is working and committing their changes into the same
branch. This means that everyone needs to update fairly regularly and
deal with other people's changes. Also, if one person commits something
that breaks the codebase, then upon syncing, everyone will get the
problem.</p>
<p>Usually, it is better to do development on different branches, and then
integrate those back into the main branch, once they are stable. This is
one of the biggest changes from working with CVS/SVN. They both allow you
to work on separate branches, but their merging algorithms are fairly
weak, so it is difficult to keep things synchronized. <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> tracks
what has already been merged, and can even apply changes to files that
have been renamed.</p>
<div class="section" id="creating-and-working-on-a-new-branch">
<h2>Creating and working on a new branch</h2>
<p>We want to keep our changes available for other people, even if they
aren't quite complete yet. So we will create a new public branch on
<tt class="docutils literal">centralhost</tt>, and track it locally.</p>
<pre class="literal-block">
% cd ~/work/sigil
% brz branch brz+ssh://centralhost/srv/brz/sigil \
             brz+ssh://centralhost/srv/brz/sigil/doodle-fixes
% brz checkout brz+ssh://centralhost/srv/brz/sigil/doodle-fixes doodle-fixes
% cd doodle-fixes
</pre>
<p>We now have a place to make any fixes we need to <tt class="docutils literal">doodle</tt>. And we would
not interrupt people who are working on other parts of the code.  Because
we have a checkout, any commits made in the <tt class="docutils literal"><span class="pre">~/work/sigil/doodle-fixes/</span></tt>
will also show up on <tt class="docutils literal">centralhost</tt>.<a class="footnote-reference" href="#nestedbranches" id="id1"><sup>1</sup></a> It is also
possible to have two developers collaborate on one of these branches, just
like they would have collaborated on the <tt class="docutils literal">dev</tt> branch.<a class="footnote-reference" href="#cbranch" id="id2"><sup>2</sup></a></p>
<table class="docutils footnote" frame="void" id="nestedbranches" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>It may look odd to have a branch in a subdirectory of
another branch. This is just fine, and you can think of it as a
hierarchical namespace where the nested branch is derived from the
outer branch.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="cbranch" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> When using lots of independent branches, having to retype
the full URL all the time takes a lot of typing. We are looking into
various methods to help with this, such as branch aliases, etc. For
now, though, the <a class="reference external" href="http://wiki.bazaar.canonical.com/brzTools">brztools</a> plugin provides the <tt class="docutils literal">brz cbranch</tt> command.
Which is designed to take a base branch, create a new public branch,
and create a checkout of that branch, all with much less typing.
Configuring <tt class="docutils literal">cbranch</tt> is outside the scope of this document, but the
final commands are similar to:</td></tr>
</tbody>
</table>
<pre class="literal-block">
% brz cbranch dev my-feature-branch
</pre>
</div>
<div class="section" id="merging-changes-back">
<h2>Merging changes back</h2>
<p>When it is decided that some of the changes in <tt class="docutils literal"><span class="pre">doodle-fixes</span></tt> are ready
to be merged into the main branch, simply do:</p>
<pre class="literal-block">
% cd ~/work/sigil/dev
% brz merge ../doodle-fixes
</pre>
<p>Now the changes are available in the <tt class="docutils literal">dev</tt> branch, but they have not
been committed yet. This is the time when you want to review the final
changes, and double check the code to make sure it compiles cleanly and
passes the test suite. The commands <tt class="docutils literal">brz status</tt> and <tt class="docutils literal">brz diff</tt> are
good tools to use here. Also, this is the time to resolve any conflicts.
<a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> will prevent you from committing until you have resolved these
conflicts. That way you don't accidentally commit the conflict markers.
The command <tt class="docutils literal">brz status</tt> will show the conflicts along with the other
changes, or you can use <tt class="docutils literal">brz conflicts</tt> to just list conflicts. Use
<tt class="docutils literal">brz resolve file/name</tt> or <tt class="docutils literal">brz resolve <span class="pre">--all</span></tt> once conflicts have
been handled.<a class="footnote-reference" href="#resolve" id="id3"><sup>3</sup></a> If you have a conflict that is particularly
difficult to solve you may want to use the <tt class="docutils literal">brz remerge</tt> command. It
will let you try different merge algorithms, as well as let you see the
original source lines (<tt class="docutils literal"><span class="pre">--show-base</span></tt>).</p>
<table class="docutils footnote" frame="void" id="resolve" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Some systems make you resolve conflicts as part of the merge
process. We have found that it is usually easier to resolve conflicts
when you have the view of the entire tree, rather than just a single
file. It gives you much more context, and also lets you run tests as
you resolve the problems.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="recommended-branching">
<h2>Recommended Branching</h2>
<p>One very common way to handle all of these branches is to give each
developer their own branch, and their own place to work in the central
location. This can be done with:</p>
<pre class="literal-block">
% brz branch brz+ssh://centralhost/srv/brz/sigil \
             brz+ssh://centralhost/srv/brz/sigil/user-a
% brz branch brz+ssh://centralhost/srv/brz/sigil \
             brz+ssh://centralhost/srv/brz/sigil/user-b
</pre>
<p>This gives each developer their own branch to work on. And, they can
easily create a new feature branch for themselves with just<a class="footnote-reference" href="#cbranch" id="id4"><sup>2</sup></a></p>
<pre class="literal-block">
% brz branch brz+ssh://centralhost/srv/brz/sigil/user-a \
             brz+ssh://centralhost/srv/brz/sigil/user-a/feature
% cd ~/work/sigil
% brz checkout brz+ssh://centralhost/srv/brz/sigil/user-a/feature myfeature
</pre>
</div>
</div>
<div class="section" id="glossary">
<h1>Glossary</h1>
<div class="section" id="shared-repository">
<h2>Shared Repository</h2>
<p><a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> has the concept of a &quot;Shared Repository&quot;. This is similar to
the traditional concept of a repository in other VCSs like CVS and
Subversion. For example, in Subversion you have a remote repository,
which is where all of the history is stored, and locally you don't
have any history information, only a checkout of the working tree
files. Note that &quot;Shared&quot; in this context means shared between
branches. It <em>may</em> be shared between people, but standalone branches
can also be shared between people.</p>
<p>In <a class="reference external" href="https://www.breezy-vcs.org/">Breezy</a> terms, a &quot;Shared Repository&quot; is a location where multiple
branches can <strong>share</strong> their revision history information. In order to
support decentralized workflows, it is possible for every branch to
store its own revision history information. But this is often
inefficient, since related branches share history, and they might as
well share the storage as well.</p>
<!-- vim: tw=74 ft=rst spell spelllang=en_us -->
</div>
</div>
</div>
</body>
</html>
