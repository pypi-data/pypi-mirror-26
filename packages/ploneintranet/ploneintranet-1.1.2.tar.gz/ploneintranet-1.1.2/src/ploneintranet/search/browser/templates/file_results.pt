<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="ploneintranet">
  <body>

    <div metal:fill-slot="content">
    <form action="${request/getURL}" id="global-search">

      <div class="container input">
        <fieldset class="search pat-subform pat-autosubmit pat-inject"
                  data-pat-inject="source: #results; target: #results; &amp;&amp; source: #tabs-nav; target: #tabs-nav; history: record;">
          <label>
            <input type="search" name="SearchableText" placeholder="Search the entire intranet" value="${request/SearchableText|nothing}"
                   i18n:attributes="placeholder label_search_entire_intranet"
                   />
          </label>
          <button type="search" i18n:translate="">Search</button>
        </fieldset>
      </div>

      <nav class="tabs navigation" id="tabs-nav">
        <a href="@@search?SearchableText=${request/SearchableText|nothing}"
           i18n:translate="">All</a>
        <a href="@@search_people?SearchableText=${request/SearchableText|nothing}"
           i18n:translate="">People</a>
        <a href="@@search_images?SearchableText=${request/SearchableText|nothing}"
           i18n:translate="">Images</a>
        <a href="@@search_files?SearchableText=${request/SearchableText|nothing}"
           class="current" i18n:translate="">Files</a>
        </nav>

      <div class="results" id="results">

        <div class="container results"
             tal:define="search_response view/search_files"
             tal:condition="search_response">
          
          <p i18n:translate=""><span i18n:name="results" tal:replace="search_response/total_results">87</span> items matched your search.</p>
          
          <div class="office results pat-masonry office-files" data-pat-masonry="column-width: .item; gutter: 0;">
            <tal:result repeat="result search_response">
              <a href="${result/url}${python:view.url_fragments.get(result.portal_type)}" class="item">
                <figure>
                  <img tal:define="spacer python:result.description and ' - ' or ' '"
                       tal:attributes="src result/preview_image_url;
                                       title string:${result/title}${spacer}${result/description} "/>
                  <figcaption tal:attributes="class string:icon-file">
                    <tal:title tal:replace="result/title" />
                  </figcaption>
                </figure>
              </a>
            </tal:result>
	    <p tal:define="next_url python: 
			   view.next_page_url(search_response.total_results)"
	       tal:condition="next_url">
	      <a href="${next_url}" i18n:translate="">More results</a>
	    </p>
          </div>

        </div><!-- /container results -->
      </div><!-- /#results results -->
      
    </form>
    </div><!-- /content -->
  </body>
</html>
