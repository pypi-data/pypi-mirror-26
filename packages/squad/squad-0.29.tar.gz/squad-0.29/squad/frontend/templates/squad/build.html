{% extends "squad/base.html" %}
{% load squad %}
{% load static %}

{% block content %}
{% include "squad/build-nav.html" %}

<h2>Metadata</h2>
{% include "squad/_metadata.html" %}

<h2>Test results</h2>
<div class='test-results highlight-row'>
{% for test_run in build.test_runs.all %}
{% for status in test_run.status.all %}
{% if status.suite and status.has_tests %}
<a href="{% project_url test_run %}#tests-{{status.suite}}">
<div class='row {% if status.tests_fail%} fail {%endif%}'>
    <div class='col-md-3 col-sm-3' title='Test suite'>
        <i class='fa fa-list'></i>
        <strong>{{status.suite}}</strong>
    </div>

    <div class='col-md-3 col-sm-3' title='Environment'>
        <i class='fa fa-microchip'></i>
        {{test_run.environment}}
    </div>

    <div class='col-md-4 col-sm-4' title='Test results'>
        <i class='fa fa-check-square-o'></i>
        <span class="badge" data-toggle="tooltip" data-placement="top" title="Total">{{status.tests_total}} tests</span>
        {% if status.tests_pass > 0 %}
        <span class="badge alert-success" data-toggle="tooltip" data-placement="top" title="Pass">{{status.tests_pass}} pass</span>
        {% endif %}
        {% if status.tests_skip > 0 %}
        <span class="badge alert-warning" data-toggle="tooltip" data-placement="top" title="Skip">{{status.tests_skip}} skip</span>
        {% endif %}
        {% if status.tests_fail > 0 %}
        <span class="badge alert-danger" data-toggle="tooltip" data-placement="top" title="Fail">{{status.tests_fail}} fail</span>
        {% endif %}
    </div>

    <div class='col-md-2 col-sm-2' title='Test run'>
        <i class='fa fa-cog'></i>
        {{test_run.job_id}}
    </div>
</div>
</a>
{% endif %}
{% endfor %}
{% endfor %}
</div>

<h2>Metrics</h2>
<div class='metrics highlight-row'>
{% for test_run in build.test_runs.all %}
{% for status in test_run.status.all %}
{% if status.suite and status.has_metrics %}
<a href="{% project_url test_run %}#metrics-{{status.suite}}">
<div class='row'>
    <div class='col-md-3 col-sm-3' title='Metrics suite'>
        <i class='fa fa-list'></i>
        <strong>{{status.suite}}</strong>
    </div>

    <div class='col-md-3 col-sm-3' title='Environment'>
        <i class='fa fa-microchip'></i>
        {{test_run.environment}}
    </div>

    <div class='col-md-4 col-sm-4' title='Metrics summary'>
        <i class='fa fa-line-chart'></i>
        {{status.metrics_summary|floatformat:3}}
    </div>

    <div class='col-md-2 col-sm-2' title='Test runs'>
        <i class='fa fa-cog'></i>
        {{test_run.job_id}}
    </div>
</div>
</a>
{% endif %}
{% endfor %}
{% endfor %}
</div>

{% endblock %}


{% block javascript %}
<script type="text/javascript" src='{% static "squad/resubmit.js" %}'></script>
{% endblock %}
