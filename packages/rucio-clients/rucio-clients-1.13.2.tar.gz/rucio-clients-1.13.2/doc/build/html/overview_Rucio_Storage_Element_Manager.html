
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Rucio Storage Element Wrapper and Manager &#8212; Rucio 1.12.2 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.12.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scheduled Transfers" href="overview_Scheduled_Transfers.html" />
    <link rel="prev" title="Overview of Rucio Architecture" href="overview_Architecture.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32728665-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="overview_Scheduled_Transfers.html" title="Scheduled Transfers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview_Architecture.html" title="Overview of Rucio Architecture"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Rucio 1.12.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="rucio-storage-element-wrapper-and-manager">
<h1>Rucio Storage Element Wrapper and Manager<a class="headerlink" href="#rucio-storage-element-wrapper-and-manager" title="Permalink to this headline">¶</a></h1>
<p><strong>DRAFT VERSION: WORK IN PROGRESS</strong></p>
<p>Rucio Storage Elements (RSE) are container for physical files. They are
designed to provide a way to define each storage and all its supported
protocols separately and include them in a transparent way for users and
developers. Doing so creates the flexibility to add new storages and protocols
to the system without changing other classes using RSEs. It further allows for
separate update strategies for each storage, as all information needed to
interact with a specific storage is gathered at runtime (Rucio Storage Element
Properties (RSEProperties) and Rucio Storage Element Protocol Type
(RSEProtocol)).</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="architectural-overview">
<h3>Architectural Overview<a class="headerlink" href="#architectural-overview" title="Permalink to this headline">¶</a></h3>
<p>As illustrated below, each complex class (representing a particular
workflow/use case) uses one or more basic (or even complex) classes to perform
the intended operation. One of these basic classes is the RSE class, describing
a generic storage element. Whenever interaction with a storage is requested by
any other class inside Rucio it instantiates a generic RSE object. The ID of
the actual storage must be provided as a parameter to the init-function. As
this class offers a common interface, supported by all storages, no further
knowledge about a specific storage or protocol is required at this time.</p>
<img alt="_images/RSE_overview.png" src="_images/RSE_overview.png" />
<p>Because some storages use the same protocol,  a Rucio-wide pool of protocol
implementations for the system is also provided. What protocols (cloud be more
than one) are supported by a specific storage is defined in its according
properties (RSEProperties). Unfortunately, different version/implementations of
one protocol, which differ in various ways, are implemented by the different
storages. Due to re-usability reasons we therefore decided to allow various
subtypes of each protocol. If for example a specific storage supports SRM, but
not in the default implementation, it defines in its properties which
particular subtype it supports.
.. }}}</p>
</div>
<div class="section" id="what-happens-during-instantiation">
<h3>What Happens During Instantiation<a class="headerlink" href="#what-happens-during-instantiation" title="Permalink to this headline">¶</a></h3>
<p>In this section we explain what actually happens when (a) an RSE object is
instantiated and (b) interaction with a specific storage is requested.</p>
<img alt="_images/RSE_sequence_instantiation.png" src="_images/RSE_sequence_instantiation.png" />
<p>Whenever an interaction with a storage is requested, an RSE object has to be
instantiated. The illustration above gives an overview about what happens at
run-time during its instantiation.</p>
<p><strong>1. Repository Lookup:</strong> To allow the generic RSE object to interact with a
specific storage, the properties defined for it must be requested from the
Rucio Storage Properties Repository. What this properties are in particular
will be discussed in the according section later in this document.</p>
<p><strong>2. Interpreting The Properties:</strong> Based on the information received in Step
One, the RSE object is now able to set its internal properties to allow future
interaction with the requested storage. Examples for this internal values are
the storage specific prefix for physical file names, the names of the supported
protocols, or the URI of the storage, to name only a few. Again, a detailed
discussion about this properties is given in the according section later in
this document.</p>
<p><strong>3. Instantiating The Protocol:</strong> Now all information about the requested
storage is set up, the RSE object instantiates the specified protocol class.
Because all protocols in the pool provide similar functionality, they can be
used in an arbitrary way. The instance of the protocol is kept as a private
member of the RSE object, as it is of no further interest for any other class.</p>
<p><strong>4. Initializing an Authenticated User Session:</strong> Each protocol class in the
pool initializes an authenticated user session which is stored inside the
protocol object for later usage. This avoids unnecessary traffic and workload
created by user authentication for each storage request and therefore
compliments the overall system performance.</p>
<p><strong>5. Instantiating the Authenticated User Session at the Storage System:</strong>
Finally the user session must be authenticated at the specified storage system
for later usage.</p>
<p>After these four steps, the generic RSE object has become storage specific.
What operations are supported by these RSE objects will be discussed in the
according section later in this document.</p>
<p>In the following we discuss what happens if storage interaction is requested
from an already instantiated RSE object. It should be noted that in the
illustration below all objects are provided/created at some point before the
focus of the illustration.</p>
<img alt="_images/RSE_sequence_usage.png" src="_images/RSE_sequence_usage.png" />
<p><strong>1. Interaction Request:</strong> Whenever a complex class wants to interaction with
the specified storage, it uses one of the operations provided by the RSE
object. This operation could be for example GET a file, GET a directory
listing, DELETE a file, … A detailed discussion about the provided operations
is given in the according section later in this document.</p>
<p><strong>2. Parameter Transformation:</strong> First the RSE object has to adapt the input
parameters in a way to match the referred storage (e.g.  transforming the
logical file name (LFN) to the physical file name (PFN), adding storage
specific prefixes). All adaptations are based on information received from the
Rucio Storage Properties Repository during object instantiation. At the end of
this block, the input parameters are matching the interface (by structure and
value) of the according operation implemented by the specified protocol.</p>
<p><strong>3. Calling the According Protocol Operation:</strong> Because now all parameters are
ready to be used by the protocol, the RSE object can delegate the actual
storage interaction to the protocol object.</p>
<p><strong>4. Using the Authenticated User Session:</strong> The protocol object reuses the
authenticated user session created during the instantiation to interact
directly with the referred storage system.</p>
<p><strong>5. The Actual Storage Interaction:</strong> The interaction with the storage system
is performed as defined in the protocol.</p>
</div>
</div>
<div class="section" id="rucio-storage-element-object">
<h2>Rucio Storage Element Object<a class="headerlink" href="#rucio-storage-element-object" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in the introduction, Rucio Storage Elements (RSE) are the main
components used to access files inside a storage system. In this section we
discuss its API and provide some Python snippets how a they are intended to be
used.</p>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create">
<h4>CREATE<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h4>
<p>Whenever a new instance of an RSE class is created, the ID of the targeted
storage and the protocol to use can be provided as paremters.  If not, RSE will
select a storage system and a protocol automatically, based on the current
state of the various storage systems.</p>
<p><strong>Instantiating an RSE object can be done on four different ways:</strong></p>
<p>The first example instantiates an RSE to interact with the storage
‘Ralph-Laptop’ and specifies to use exclusively the S3 protocol for it.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 1. Specific Storage, Specific Protocol</span>
<span class="n">my_storage</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="s">&#39;Ralph-Laptop&#39;</span><span class="p">,</span> <span class="s">&#39;protocol&#39;</span><span class="p">:</span><span class="s">&#39;s3&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The second example instantiates an RSE object to interact with the storage
‘Ralph-Laptop’ and specifies to use the preferred protocol of the storage
system for it.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 2. Specific Storage, Unspecified  Protocol</span>
<span class="n">my_storage</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span><span class="s">&#39;Ralph-Laptop&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The third example instantiates an RSE object to an unspecified storage
supporting the S3 protocol. Which storage is actually used may vary from
instantiation to instantiation, depending on the current state of each
registered storage. See the section about Properties for further information on
this topic.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 3. Unspecific Storage, Specific Protocol</span>
<span class="n">my_storage</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;protocol&#39;</span><span class="p">:</span><span class="s">&#39;s3&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
<p>The fourth example instantiates an RSE object to an unspecified storage using
its preferred protocol. Which storage is actually used may vary from
instantiation to instantiation, depending on the current state of each
registered storage. See the section about Properties for further information on
this topic.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 4. Unspecific Storage, Unspecific Protocol</span>
<span class="n">my_storage</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="get">
<h4>GET<a class="headerlink" href="#get" title="Permalink to this headline">¶</a></h4>
<p>The get-method provides functionality to access either the content of a file or
its meta-data.  It can be used in two different ways:</p>
<p><strong>1. The Object is Already Created by a Previous ‘Create-Statement’:</strong> As
described above, if the object is already instantiated it is connected to a
specific storage and therefore only the Logical File Name (LFN) must be
provided to the get-method.  If only the LFN is provided as input, the
get-method responds the content of the referred file, while appending
‘/meta-data’ to the LFN (REST-like resource addressing) indicates that only the
meta-data of the file are requested. The meta-data of the file will be
responded as a JSON object.</p>
<p>The following example assumes that the RSE object (my_rse) was already created by some
preceding statements:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="n">meta</span> <span class="o">=</span> <span class="n">my_rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;my_logical_file_name/meta-data&#39;</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">my_rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;my_logical_file_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The snippet above first requests the meta-data of the file
‘my_logical_file_name’ and afterwards its content. Because this time the RSE
object is already connected to a specific storage and a protocol, no further
information must be provided.</p>
<p><strong>2. Using the Get-Method from the Class Instead of the Object:</strong> If there is
no RSE-object, it is possible to use the get-method implemented by the class
itself. Because the RSE class is not connected to any specific storage or
protocol, this information must be provided preceding the LFN (inspired by
URIs). E.g.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Bad if both statements are here, OK if only one is</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name/meta-data&#39;</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The snippet above, again requests the meta-data of the file
‘my_logical_file_name’ located at the storage system ‘Ralph-Laptop’ using the
S3 protocol and afterwards its content. The major difference to the snippet
before is, that this time the user authenticated session at the storage system
must be created before the request and will be closed immediately after the
request is finished. Therefore <strong>the usage of this operation should be omitted
if one or more files are expected to be requested later on.</strong></p>
</div>
<div class="section" id="put">
<h4>PUT<a class="headerlink" href="#put" title="Permalink to this headline">¶</a></h4>
<p>Using this operation allows for updating already existing data in the storage
system. Again, like for the get-method, two different modes (one with and one
without a pre-existing RSE object) are implemented. The advantages and
disadvantages of the two methods are the same as for the get-method and
therefore not discussed here again.</p>
<p>The snippets below give an example how to update a file or its meta-data at a
specific storage.</p>
<p>1. To update a files content in the storage system the LFN of the file and the
local file object of the new version (local_file_content) must be provided as
input.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 1. Pre-Existing RSE object (my_rse)</span>
<span class="n">my_rse</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">)</span>

<span class="c"># 2. Using the class operation</span>
<span class="n">rse</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">)</span>
</pre></div>
</div>
<p>2. To update the meta-data of a file the LFN and the JSON object, representing
them, must be provided as input.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># 1. Pre-Existing RSE object (my_rse)</span>
<span class="n">my_rse</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;my_logical_file_name/meta-data&#39;</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>

<span class="c"># 2. Using the class operation</span>
<span class="n">rse</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name/meta-data&#39;</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Note:</strong> Only meta-data included in the provided JSON object and the file
meat-data will be updated. Meta-data that is present in the storage, but
missing in the JSON object will stay unchanged. Meta-data present in the JSON
object but missing in the meta-data of the file (or the according schema) will
be ignored.</p>
</div>
<div class="section" id="post">
<h4>POST<a class="headerlink" href="#post" title="Permalink to this headline">¶</a></h4>
<p>Using this operation allows for creating new data in the storage system. Again,
like for the get-method, two different modes (one with and one without a
pre-existing RSE object) are implemented. The advantages and disadvantages of
the two methods are the same as for the get-method and therefore not discussed
here again.</p>
<p>To create data in the storage system the LFN of the file, the local file object
(local_file_content) and it meta-data represented by a JSON object
(local_meta_data) must be provided as input.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Pre-Existing RSE object (my_rse)</span>
<span class="n">my_rse</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>

<span class="c"># Using the class operation</span>
<span class="n">rse</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>
</pre></div>
</div>
<p>The snippets above give an example how to insert a file and its meta-data to a
specific storage.</p>
</div>
<div class="section" id="delete">
<h4>DELETE<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h4>
<p>Using this operation allows for deleting data from the storage system. Again,
like for the get-method, two different modes (one with and one without a
pre-existing RSE object) are implemented. The advantages and disadvantages of
the two methods are the same as for the get-method and therefore not discussed
here again.</p>
<p>To delete a specific file from a storage system only its LFN must be provided.
Whenever a file is removed from a storage system, the according meta-data is
too. At this point it should be noted that <strong>no wildcard support</strong> is
implemented by this method.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Pre-Existing RSE object (my_rse)</span>
<span class="n">my_rse</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>

<span class="c"># Using the class operation</span>
<span class="n">rse</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;s3://Ralph-Laptop/my_logical_file_name&#39;</span><span class="p">,</span> <span class="n">local_file_content</span><span class="p">,</span> <span class="n">local_meta_data</span><span class="p">)</span>
</pre></div>
</div>
<p>The snippets above give an example how to delete a file from a specific
storage.</p>
</div>
</div>
<div class="section" id="example-code">
<h3>Example Code<a class="headerlink" href="#example-code" title="Permalink to this headline">¶</a></h3>
<p>Here, a couple of sample use cases are provided to give an idea how RSE objects
are intended to be used by developers.</p>
<p>Fetching File Data (multiple times)</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Fetching three particular files from a specified storage using its preferred</span>
<span class="c"># protocol</span>

<span class="n">lfns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;some_very_logical_file_name&#39;</span><span class="p">,</span> <span class="s">&#39;also_some_very_logical_file_name&#39;</span><span class="p">,</span><span class="s">&#39;again_some_very_logical_file_name&#39;</span><span class="p">]</span>
<span class="n">storage_id</span> <span class="o">=</span> <span class="s">&#39;some_awsome_storage&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">my_rse</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">storage_id</span><span class="p">})</span>
  <span class="k">for</span> <span class="n">lfn</span> <span class="ow">in</span> <span class="n">lfns</span><span class="p">:</span>
    <span class="n">file_meta_data</span> <span class="o">=</span> <span class="n">my_rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lfn</span> <span class="o">+</span> <span class="s">&#39;/meta-data&#39;</span><span class="p">)</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="n">my_rse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lfn</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="n">lfn</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;content&#39;</span> <span class="p">:</span> <span class="n">file_content</span><span class="p">,</span> <span class="s">&#39;meta-data&#39;</span> <span class="p">:</span> <span class="n">file_meta_data</span><span class="p">}</span>
<span class="n">expect</span> <span class="n">RSEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s">&#39;Error No: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
</pre></div>
</div>
<p>Updating File Meta-Data</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Updating the meta-data of one specific file at a specific storage.</span>
<span class="c"># Because in this use-case we assume that no further interaction with</span>
<span class="c"># the referred storage is planed, the class method is used:</span>

<span class="n">updated_meta_data</span> <span class="o">=</span> <span class="o">...</span> <span class="c"># Representing the results of all the painful analyzing work</span>
<span class="n">lfn</span> <span class="o">=</span> <span class="s">&#39;some_very_logical_file_name&#39;</span>
<span class="n">storage_id</span> <span class="o">=</span> <span class="s">&#39;some_awsome_storage&#39;</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">rse</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;s3://&#39;</span> <span class="o">+</span>  <span class="n">storage_id</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">lfn</span> <span class="o">+</span> <span class="s">&#39;/meta-data&#39;</span><span class="p">,</span> <span class="n">updated_meta_data</span><span class="p">)</span>
<span class="n">expect</span> <span class="n">RSEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s">&#39;Error No: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
</pre></div>
</div>
<p>Creating a new File</p>
<div class="highlight-default"><div class="highlight"><pre><span class="c"># Creating a new file in a specified storage, using a specified protocol.</span>
<span class="c"># Because in this use-case we assume that some further interaction with this</span>
<span class="c"># particular storage will follow, we create an RSE object instead of using the</span>
<span class="c"># class method.</span>

<span class="n">storage_id</span> <span class="o">=</span> <span class="s">&#39;some_awsome_storage&#39;</span>
<span class="n">protocol_id</span> <span class="o">=</span> <span class="s">&#39;S3&#39;</span>
<span class="n">lfn</span> <span class="o">=</span> <span class="s">&#39;some_very_logical_file_name&#39;</span>
<span class="n">file_meta_data</span> <span class="o">=</span> <span class="o">...</span> <span class="c"># Representing the meta-data as JSON</span>
<span class="n">file_content</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;somewhere/on/my/disk/is/my_local_file&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">my_rse</span> <span class="o">=</span> <span class="n">rse</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="n">storage_id</span><span class="p">,</span> <span class="s">&#39;protocol&#39;</span> <span class="p">:</span> <span class="n">protocol_id</span> <span class="p">})</span>
  <span class="n">my_rse</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">lfn</span><span class="p">,</span> <span class="n">file_conent</span><span class="p">,</span> <span class="n">file_meta_data</span><span class="p">)</span>
<span class="n">expect</span> <span class="n">RSEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s">&#39;Error No: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_id</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rucio-storage-properties-object">
<h2>Rucio Storage Properties Object<a class="headerlink" href="#rucio-storage-properties-object" title="Permalink to this headline">¶</a></h2>
<p>To enable an RSE object to interact with each storage system, specified inside
the Rucio Storage Properties Repository, a common set of properties is needed.
Further are these properties acting as a base for automatic decision making
when automatic storage selection is used. All this information is represented
by Rucio Storage Element Properties (RSEPs).</p>
<p>In order to achieve the intended functionality, the information of each storage
is split into two major parts (namely static and dynamic). Each part must
represent a common set of key-value pairs provided by all storage systems
specified inside the repository.</p>
<p>In the following the understanding of the terms ‘static properties’, and
‘dynamic properties’ is discussed. At the end, the according JSON Schema, as
one way to validate that each storage provides sufficient and well-formed
information when added to the repository, is given.</p>
<div class="section" id="static-properties">
<h3>Static Properties<a class="headerlink" href="#static-properties" title="Permalink to this headline">¶</a></h3>
<p>Static properties, as understood here, do not vary on a regular basis.
Therefore this information is kept (static) inside the repository. Having this
information provided here saves bandwidth and storage computing resources every
time a client requests information about a specific storage. Further is
querying and/or filtering storages based on static information possible by
performing only one request (to the repository), what otherwise would be at
least one separate call for each storage (directly to the storage). This
increase in resource efficiency justifies the more complex maintenance task by
updating the information inside the repository whenever a static value changes.</p>
<p>The following listing gives some examples how static properties may look like.</p>
<div class="highlight-default"><div class="highlight"><pre><span class="s">&#39;static&#39;</span> <span class="p">:</span> <span class="p">{</span>
  <span class="s">&#39;id&#39;</span> <span class="p">:</span> <span class="s">&#39;cern.storage.user.ralph.laptop&#39;</span><span class="p">,</span>
  <span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;Ralph&#39;</span><span class="n">s</span> <span class="n">Laptop</span> <span class="n">at</span> <span class="n">CERN</span><span class="s">&#39;,</span>
  <span class="s">&#39;location&#39;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;address&#39;</span> <span class="p">:</span> <span class="s">&#39;1-R-024, CERN CH-1211, Genève 23&#39;</span><span class="p">,</span>
    <span class="s">&#39;country&#39;</span> <span class="p">:</span> <span class="s">&#39;CH&#39;</span>
  <span class="p">},</span>
  <span class="s">&#39;overall_diskspace&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span><span class="s">&#39;128&#39;</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span><span class="p">:</span><span class="s">&#39;GB&#39;</span><span class="p">}</span>
  <span class="s">&#39;overall_computing_power&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#39;value&#39;</span> <span class="p">;</span> <span class="s">&#39;1.4&#39;</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span> <span class="p">:</span> <span class="s">&#39;GHz&#39;</span><span class="p">},</span>
  <span class="s">&#39;protocols&#39;</span> <span class="p">:</span> <span class="p">[{</span><span class="s">&#39;s3&#39;</span><span class="p">:</span> <span class="p">[]},</span> <span class="p">{</span><span class="s">&#39;webdav&#39;</span><span class="p">:[</span><span class="s">&#39;sub1&#39;</span><span class="p">,</span><span class="s">&#39;sub2&#39;</span><span class="p">]}]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example above describes a storage system represented by one of our laptops
located at CERN, Switzerland. It has 128GB of overall disk space and 1.4 GHz
overall computing power. The supported protocols are S3 (default
implementation) and WebDAV (only subtypes sub1 and sub2).</p>
</div>
<div class="section" id="dynamic-properties">
<h3>Dynamic Properties<a class="headerlink" href="#dynamic-properties" title="Permalink to this headline">¶</a></h3>
<p>In contrast to static properties, dynamic properties vary from request to
request. Examples for such properties are current work load, available disk
space, current connection bandwidth, … Because of their dynamic nature, the
values of this properties are not kept inside the repository. For this
scenario, it saves resources if the values are requested from the storage on
demand instead of automatically update the repository information each time a
certain value changes, like static properties.</p>
<p>To enable the client to query these dynamic properties, each property is
represented by a method which must be defined inside the class of the according
protocol. If a storage systems requires different operations to the one defined
inside the default one to provided the requested information, a new subtype
protocol must be defined. This way, the flexibility for each storage system to
implement its individual way to provide the requested data is provided.</p>
<div class="highlight-default"><div class="highlight"><pre>&#39;dynamic&#39; : {
  &#39;s3&#39; : {
    &#39;available_disk_space&#39; : {
      &#39;method&#39; : &#39;get_diskspace()&#39;,
      &#39;[some additional protocol specific information]&#39;
    },
    &#39;current_workload&#39; : {
      &#39;method&#39; : &#39;get_workload()&#39;,
      &#39;[some additional protocol specific information]&#39;
    },
  …
  }
  &#39;webdav_sub1&#39; : {
    &#39;available_disk_space&#39; : {
      &#39;method&#39; : &#39;get_diskspace()&#39;,
      &#39;[some additional protocol specific information]&#39;
    },
    &#39;current_workload&#39; : {
      &#39;method&#39; : &#39;get_workload()&#39;,
      &#39;[some additional protocol specific information]&#39;
    },
  …
  },
  &#39;webdav_sub2&#39; : {
    …
  },
…
}
</pre></div>
</div>
<p>The example above specifies for the according storage system and its supported
protocols, how clients are able to request data using the according protocol
object.</p>
</div>
<div class="section" id="json-schema">
<h3>JSON Schema<a class="headerlink" href="#json-schema" title="Permalink to this headline">¶</a></h3>
<p>To guarantee the information provided for each storage matches the common set,
a JSON schema <a class="footnote-reference" href="#id2" id="id1">[1]</a> is defined. Using this schema allows clients to verify if
the responded data is valid, and therefore helps to write less complex code
during implementation. Further supports this schema developers when defining
the RSEP for a storage system by acting as a guideline. Again, by validating
the RSEP against the schema, mistakes and errors can be prevented. Inside the
central repository the validation of the data is performed automatically each
time a information about a storage is created or updated.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Link to JSON Schema: <a class="reference external" href="http://json-schema.org/">http://json-schema.org/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="implementation-details">
<h3>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h3>
<p>If there is something that needs to be explained further it will be written here.</p>
</div>
</div>
<div class="section" id="rucio-storage-protocol-object">
<h2>Rucio Storage Protocol Object<a class="headerlink" href="#rucio-storage-protocol-object" title="Permalink to this headline">¶</a></h2>
<p><strong>VERY FLUFFY - more thinking needs to be done</strong></p>
<p>As already mentioned above, in Rucio a pool with various protocols is provided.
These protocols represent the actual interaction with the storage systems e.g.
using SRM or S3.  Because of the heterogeneity of the different storage
systems, also sub types of protocols are supported. This way each storage
system is able to describe its own implementation specialities (see also Rucio
Storage Element Properties for details).</p>
<div class="section" id="id3">
<h3>Methods<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The Rucio Storage Protocol class is used whenever an RSE object interacts with
a storage system.  To enable this in a transparent way, each protocol or sub
type must implement at least the methods defined in the generic protocol class,
representing a common set of operations provided by each storage system. To
ensure this, each protocol class must be inherited from the generic class.</p>
<div class="section" id="create-session">
<h4>CREATE_SESSION<a class="headerlink" href="#create-session" title="Permalink to this headline">¶</a></h4>
<p>Creates an authenticated user session at the specified storage system.
TODO: Rucio Authentication</p>
</div>
<div class="section" id="close-session">
<h4>CLOSE_SESSION<a class="headerlink" href="#close-session" title="Permalink to this headline">¶</a></h4>
<p>Closes the existing user authenticated session at the according storage system.</p>
</div>
<div class="section" id="read">
<h4>READ<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h4>
<p>Returns the content of the requested file from the storage system.</p>
</div>
<div class="section" id="write">
<h4>WRITE<a class="headerlink" href="#write" title="Permalink to this headline">¶</a></h4>
<p>Writes the provided data into the referred file at the storage system.</p>
</div>
<div class="section" id="register-file">
<h4>REGISTER_FILE<a class="headerlink" href="#register-file" title="Permalink to this headline">¶</a></h4>
<p>Registers the uploaded file with its LFN and PFN at the according storage
system.</p>
</div>
<div class="section" id="id4">
<h4>DELETE<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Deletes the referred file from the storage system.</p>
</div>
<div class="section" id="lfn2pfn">
<h4>LFN2PFN<a class="headerlink" href="#lfn2pfn" title="Permalink to this headline">¶</a></h4>
<p>Converts the logical file name into the physical file name of the according
storage system.</p>
</div>
</div>
</div>
<div class="section" id="rucio-storage-exception-object">
<h2>Rucio Storage Exception Object<a class="headerlink" href="#rucio-storage-exception-object" title="Permalink to this headline">¶</a></h2>
<p>Like Rucio itself, RSE objects use RucioExceptions to escalate errors.  For
easier coding it is sub-classed as RSEException.</p>
<p>An RSEException consists of three attributes: the ID representing an unique
integer identifier for each exception, the message text which is printed along
side the ID if the exception is transformed to string and a data field for
additional information to the exception.</p>
<div class="section" id="exception-codes">
<h3>Exception Codes<a class="headerlink" href="#exception-codes" title="Permalink to this headline">¶</a></h3>
<p>In the following a comprehensive list of all exceptions is given.
TODO: Discuss if this list comprehensive, what is not needed</p>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="21%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ID</th>
<th class="head">Message Text</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>101</td>
<td>Switching Protocols</td>
<td>The storage indicates the client to use a different protocol to fulfil its request.</td>
</tr>
<tr class="row-odd"><td>202</td>
<td>Requested Accepted</td>
<td>Indicates that the request successfully transmitted to storage and that it will be executed later.</td>
</tr>
<tr class="row-even"><td>204</td>
<td>No Response</td>
<td>The storage has completed the request, but no content is provided to the client.</td>
</tr>
<tr class="row-odd"><td>300</td>
<td>Multiple Endpoints</td>
<td>The storage provides this file multiple times (with different protocol) and the client has to select one.</td>
</tr>
<tr class="row-even"><td>301</td>
<td>Moved Permanently</td>
<td>The requested file has been permanently moved to a different location.</td>
</tr>
<tr class="row-odd"><td>302</td>
<td>Found (but at a different endpoint)</td>
<td>The requested resource resides temporarily under a different URI.</td>
</tr>
<tr class="row-even"><td>304</td>
<td>Not modified</td>
<td>The requested file can be found in the client cache.</td>
</tr>
<tr class="row-odd"><td>400</td>
<td>Bad Request</td>
<td>The requested was rejected by the server due to malformed syntax.</td>
</tr>
<tr class="row-even"><td>402</td>
<td>Payment Required</td>
<td>Nothing more to say. :)</td>
</tr>
<tr class="row-odd"><td>403</td>
<td>Forbidden</td>
<td>The client has not necessary privileges to access this resource at this storage.</td>
</tr>
<tr class="row-even"><td>404</td>
<td>Resource Not Found</td>
<td>The requested resource was not found at the specified storage.</td>
</tr>
<tr class="row-odd"><td>405</td>
<td>Method Not Allowed</td>
<td>The method specified in the Request-Line is not allowed for the resource identified by the Request-URI.</td>
</tr>
<tr class="row-even"><td>409</td>
<td>Conflict</td>
<td>The clients request is in conflict with the rules defined for the storage.</td>
</tr>
<tr class="row-odd"><td>410</td>
<td>Gone</td>
<td>The requested resource is no longer available at this storage.</td>
</tr>
<tr class="row-even"><td>413</td>
<td>Requested Entity To Large</td>
<td>The storage is refusing to process a request because the request entity is larger than the storage is willing or able to process.</td>
</tr>
<tr class="row-odd"><td>500</td>
<td>Something Embarrassing Happened</td>
<td>Should not happen.</td>
</tr>
<tr class="row-even"><td>503</td>
<td>Service Unavailable</td>
<td>The requested service temporary not accessible for the client.</td>
</tr>
<tr class="row-odd"><td>504</td>
<td>Gateway Timeout</td>
<td>The storage received a timeout while interacting with other storages.</td>
</tr>
</tbody>
</table>
<p>Note: Because in Rucio Exception are always related to some unsolicited
behaviour, they are not used to confirm an expected state.</p>
</div>
<div class="section" id="id5">
<h3>Methods<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-id">
<h4>GET_ID<a class="headerlink" href="#get-id" title="Permalink to this headline">¶</a></h4>
<p>Returns the ID of the exception according to the list above.</p>
</div>
<div class="section" id="get-message">
<h4>GET_MESSAGE<a class="headerlink" href="#get-message" title="Permalink to this headline">¶</a></h4>
<p>Returns the description of the message as defined in the list above.</p>
</div>
<div class="section" id="get-data">
<h4>GET_DATA<a class="headerlink" href="#get-data" title="Permalink to this headline">¶</a></h4>
<p>Returns a dictionary including additional information to the exception.  For
example the ID of the protocol if the error with the ID 101 is thrown or the
URI of the storage where the requested file can be found if the error 302 is
thrown. Details about this additional information can be found in the list
above.</p>
</div>
<div class="section" id="to-str">
<h4>TO_STR<a class="headerlink" href="#to-str" title="Permalink to this headline">¶</a></h4>
<p>Returns a string consisting of the ID and the message of the exception.</p>
</div>
</div>
</div>
<div class="section" id="example-implementations">
<h2>Example Implementations<a class="headerlink" href="#example-implementations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="file-system">
<h3>File System<a class="headerlink" href="#file-system" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="webdav">
<h3>WebDAV<a class="headerlink" href="#webdav" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="s3">
<h3>S3<a class="headerlink" href="#s3" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div>
   <img src="_static/rucio_logo.png" alt="Rucio logo" />
</div>

  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Rucio Storage Element Wrapper and Manager</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#architectural-overview">Architectural Overview</a></li>
<li><a class="reference internal" href="#what-happens-during-instantiation">What Happens During Instantiation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rucio-storage-element-object">Rucio Storage Element Object</a><ul>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#create">CREATE</a></li>
<li><a class="reference internal" href="#get">GET</a></li>
<li><a class="reference internal" href="#put">PUT</a></li>
<li><a class="reference internal" href="#post">POST</a></li>
<li><a class="reference internal" href="#delete">DELETE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-code">Example Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rucio-storage-properties-object">Rucio Storage Properties Object</a><ul>
<li><a class="reference internal" href="#static-properties">Static Properties</a></li>
<li><a class="reference internal" href="#dynamic-properties">Dynamic Properties</a></li>
<li><a class="reference internal" href="#json-schema">JSON Schema</a></li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rucio-storage-protocol-object">Rucio Storage Protocol Object</a><ul>
<li><a class="reference internal" href="#id3">Methods</a><ul>
<li><a class="reference internal" href="#create-session">CREATE_SESSION</a></li>
<li><a class="reference internal" href="#close-session">CLOSE_SESSION</a></li>
<li><a class="reference internal" href="#read">READ</a></li>
<li><a class="reference internal" href="#write">WRITE</a></li>
<li><a class="reference internal" href="#register-file">REGISTER_FILE</a></li>
<li><a class="reference internal" href="#id4">DELETE</a></li>
<li><a class="reference internal" href="#lfn2pfn">LFN2PFN</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#rucio-storage-exception-object">Rucio Storage Exception Object</a><ul>
<li><a class="reference internal" href="#exception-codes">Exception Codes</a></li>
<li><a class="reference internal" href="#id5">Methods</a><ul>
<li><a class="reference internal" href="#get-id">GET_ID</a></li>
<li><a class="reference internal" href="#get-message">GET_MESSAGE</a></li>
<li><a class="reference internal" href="#get-data">GET_DATA</a></li>
<li><a class="reference internal" href="#to-str">TO_STR</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example-implementations">Example Implementations</a><ul>
<li><a class="reference internal" href="#file-system">File System</a></li>
<li><a class="reference internal" href="#webdav">WebDAV</a></li>
<li><a class="reference internal" href="#s3">S3</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview_Architecture.html"
                        title="previous chapter">Overview of Rucio Architecture</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="overview_Scheduled_Transfers.html"
                        title="next chapter">Scheduled Transfers</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/overview_Rucio_Storage_Element_Manager.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="overview_Scheduled_Transfers.html" title="Scheduled Transfers"
             >next</a> |</li>
        <li class="right" >
          <a href="overview_Architecture.html" title="Overview of Rucio Architecture"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Rucio 1.12.2 documentation</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, CERN.
    </div>
<div class="footer">
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>